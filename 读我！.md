# FSCell（荧光智能细胞）

FSCell 是一个面向 ImageJ/Fiji 的插件，用于自动化多通道荧光显微图像的常规处理。它可以平衡通道亮度、检测红绿信号的重叠区域，并在批量的 `.tif/.tiff` 图像中辅助统计细胞核数量，适用于包含蓝、绿、红及可选第四标记通道的图像。

> Looking for the English documentation? Read the [README](README.md).

## 功能亮点

- **批量通道合并与重叠导出**
  - 选择包含多通道 TIFF 图像的输入文件夹与导出文件夹。
  - 自动将红、绿通道归一化到可配置的平均强度，使曝光更加均衡。
  - 将蓝、绿、红通道合成为复合图像，并为每个输入文件导出处理结果。
  - 检测红绿重叠区域，为每个重叠位置绘制圆圈，并将覆盖图一同导出。
- **交互式蓝通道细胞核计数**
  - 使用自动阈值（Otsu）并提供容差滑块进行蓝通道的细胞核计数。
  - 提供最小面积控制以排除碎片，并实时更新覆盖层与计数结果。
  - 适合批处理后的快速质检，每次调整都会立刻刷新覆盖层。

## 构建

项目使用 Maven 并针对 Java 8。执行以下命令即可同时生成插件 JAR 和可直接解压的安装包：

```bash
mvn clean package
```

构建完成后会得到两个主要产物：

- `target/FSCell.jar`：独立的插件 JAR。
- `target/FSCell-fiji.zip`：包含完整文件结构的压缩包，可直接解压到 Fiji 的 `plugins` 目录使用。

## 安装步骤

### 快速安装（推荐）

1. 构建项目或从发布页下载 `FSCell-fiji.zip`。
2. 将压缩包直接解压到 ImageJ/Fiji 的 `plugins` 目录（例如 `{Fiji.app}/plugins`）。解压后会生成 `plugins/FSCell/` 文件夹，内含 `FSCell.jar`、`plugins.config` 以及快速说明。
3. 重启 ImageJ/Fiji，插件将显示在 **Plugins ▸ FSCell ▸ Batch Merge and Count** 菜单中。

### 手动安装（进阶）

1. 将 `target/FSCell.jar` 复制到 ImageJ/Fiji 的 `plugins` 目录。
2. 确保 `plugins.config` 与 JAR 位于同一目录。Maven 构建生成的 JAR 已内置此文件，同时压缩包中也提供了 `plugins/FSCell/plugins.config` 以备不时之需。
3. 重启 ImageJ/Fiji。

## 使用指南

### 批量通道合并与重叠导出

1. 启动插件并选择 **Batch merge & overlap export**。
2. 选择包含堆叠通道 `.tif/.tiff` 文件的输入目录。文件至少需包含蓝、绿、红三个通道（默认索引 1–3）。
3. 选择用于保存处理结果的输出目录。
4. 配置通道索引、目标平均强度、最小重叠区域以及圆圈半径。
5. FSCell 会生成红绿曝光平衡的复合图像，并用黄色圆圈标注红绿重叠区域。

### 交互式蓝通道细胞核计数

1. 启动插件并选择 **Interactive blue nuclei counter**。
2. 选择一个 TIFF 图像（多通道或单通道）。FSCell 会自动提取蓝通道（默认优先索引 3）。
3. 预览窗口会与容差滑块和最小面积输入框一起出现。根据需要调整以确保细胞核被正确检测。
4. 覆盖层会实时显示检测出的细胞核轮廓，状态栏会给出计数结果。

## 参与贡献

欢迎通过 Issue 或 Pull Request 提交改进、修复或新功能建议！
